---
title: HTTP API
description: RESTful API reference
---

# HTTP API

Omni CLI includes an HTTP API server for remote access, integrations, and automation.

## Starting the Server

```bash
# Default (localhost:7890)
omni serve

# Custom host and port
omni serve --host 0.0.0.0 --port 8080
```

## Endpoints

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| `GET` | `/health` | No | Health check |
| `POST` | `/api/agent` | Yes | Execute an agentic task |
| `POST` | `/api/agent/stream` | Yes | Execute with SSE streaming |
| `GET` | `/api/history` | Yes | Get task execution history |
| `GET` | `/api/share/{token}` | No | Access a shared session |
| `GET` | `/api/docs` | No | Swagger UI documentation |

## Authentication

### Generating a Token

```bash
omni config generate-token
```

Output:

```
Generated API token: omni_a1b2c3d4e5f6...
```

### Configuring the Token

Add to `~/.config/omni/cli/config.toml`:

```toml
[api]
token = "omni_a1b2c3d4e5f6..."
```

Or via environment variable:

```bash
export OMNI_API_TOKEN="omni_a1b2c3d4e5f6..."
```

### Using the Token

Include in the `Authorization` header:

```bash
curl -X POST http://localhost:7890/api/agent \
  -H "Authorization: Bearer omni_a1b2c3d4e5f6..." \
  -H "Content-Type: application/json" \
  -d '{"prompt": "What is 2+2?"}'
```

Without a token configured, the API allows unauthenticated access (suitable for localhost-only use).

## Execute Agent Task

### Request

```bash
curl -X POST http://localhost:7890/api/agent \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "List files in the current directory",
    "mode": "build"
  }'
```

### Parameters

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `prompt` | string | Yes | The task to execute |
| `mode` | string | No | `build` (default) or `plan` |
| `model` | string | No | Override the model |
| `max_tokens` | number | No | Override max tokens |

### Response

```json
{
  "success": true,
  "output": "Here are the files:\n- src/\n- Cargo.toml\n- README.md",
  "tool_calls": [
    {
      "tool": "list_dir",
      "input": {"path": "."},
      "output": "src/\nCargo.toml\nREADME.md"
    }
  ]
}
```

## Streaming Response (SSE)

For real-time output, use the streaming endpoint:

```bash
curl -X POST http://localhost:7890/api/agent/stream \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Explain quantum computing"}'
```

### Event Types

Events are sent as Server-Sent Events:

```
event: text
data: {"content": "Quantum computing"}

event: text
data: {"content": " uses qubits..."}

event: tool_start
data: {"tool": "web_search", "input": {"query": "quantum computing"}}

event: tool_end
data: {"tool": "web_search", "output": "..."}

event: done
data: {}

event: error
data: {"message": "Rate limit exceeded"}
```

### JavaScript Example

```javascript
const eventSource = new EventSource('/api/agent/stream', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer omni_...'
  },
  body: JSON.stringify({ prompt: 'Hello' })
});

eventSource.addEventListener('text', (e) => {
  const data = JSON.parse(e.data);
  console.log(data.content);
});

eventSource.addEventListener('done', () => {
  eventSource.close();
});
```

## Health Check

```bash
curl http://localhost:7890/health
```

Response:

```json
{
  "status": "ok",
  "version": "0.2.1"
}
```

## Execution History

Get recent task executions:

```bash
curl http://localhost:7890/api/history \
  -H "Authorization: Bearer omni_..."
```

Response:

```json
{
  "tasks": [
    {
      "id": "task_abc123",
      "prompt": "List files",
      "status": "completed",
      "created_at": "2024-01-15T10:30:00Z"
    }
  ]
}
```

## Shared Sessions

Access a shared session (no auth required):

```bash
curl http://localhost:7890/api/share/abc12345
```

Response:

```json
{
  "id": "session_xyz",
  "created_at": "2024-01-15T10:30:00Z",
  "messages": [...]
}
```

Returns 404 if the token is invalid or expired.

## Swagger Documentation

Interactive API documentation is available at:

```
http://localhost:7890/api/docs
```

## Error Responses

All errors follow a consistent format:

```json
{
  "success": false,
  "error": {
    "code": "unauthorized",
    "message": "Invalid or missing API token"
  }
}
```

### Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `unauthorized` | 401 | Missing or invalid token |
| `bad_request` | 400 | Invalid request body |
| `not_found` | 404 | Resource not found |
| `rate_limited` | 429 | Too many requests |
| `internal_error` | 500 | Server error |

## CORS

CORS is enabled by default for localhost origins. For production deployments, configure allowed origins:

```toml
[api]
cors_origins = ["https://myapp.com"]
```
